import string
import telebot
from telebot import types

from config import TOKEN

from pyowm import OWM
from pyowm.utils.config import get_default_config

bot = telebot.TeleBot(TOKEN)

tmp = {}


# –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫:
buttons = types.ReplyKeyboardMarkup(row_width=2, resize_keyboard=True)
button_locate = types.KeyboardButton("üåÉ  -  –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥")
button_info = types.KeyboardButton("üÜò  -  –ü–æ–º–æ—â—å")
button_weather = types.KeyboardButton("‚òÄÔ∏è  -  –£–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É")
button_author_info = types.KeyboardButton("üßëüèª‚Äçüíª  -  –û–± –ê–≤—Ç–æ—Ä–µ")
buttons.add(button_locate, button_info, button_weather, button_author_info)


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã start
@bot.message_handler(commands=['start'])
def send_welcome(message):
    bot.reply_to(
        message, f"–ü—Ä–∏–≤–µ—Ç  üëã, —è –±–æ—Ç ü§ñ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç —É–∑–Ω–∞—Ç—å –∫–∞–∫–∞—è –ø–æ–≥–æ–¥–∞ –∑–∞ –æ–∫–Ω–æ–º  ‚õÖÔ∏è. –ï—Å–ª–∏ —Ç–µ–±–µ –±—É–¥–µ—Ç —á—Ç–æ-—Ç–æ –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ, —Ç—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—à—å –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–Ω–æ–ø–∫–æ–π   \"üÜò   -   –ü–æ–º–æ—â—å\".  –£–¥–∞—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)", reply_markup=buttons
    )


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∞–µ—Ç –±–æ—Ç
@bot.message_handler(content_types=['text'])
def weather_handler(message):
    if message.text == "üßëüèª‚Äçüíª  -  –û–± –ê–≤—Ç–æ—Ä–µ":
        bot.send_message(
            message.chat.id, '''
üßëüèª‚Äçüíª  -  –ê–≤—Ç–æ—Ä: @pwp_programer
üêô  -  GitHub: https://github.com/pwp-programer
üí∏  -  –î–æ–Ω–∞—Ç—ã: 4890 4947 9688 0706
        ''')

    if message.text == "üåÉ  -  –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥":
        tmp[message.chat.id] = []
        bot.send_message(
            message.chat.id, "__",
            reply_markup=(types.ReplyKeyboardRemove())
        )
        bot.register_next_step_handler(message, city)

    if message.text == "üÜò  -  –ü–æ–º–æ—â—å":
        bot.send_message(
            message.chat.id,
            '''
–ï—Å–ª–∏ –≤—ã –Ω–∞–∂–∞–ª–∏, –Ω–∞ —ç—Ç—É –∫–Ω–æ–ø–∫—É, —Ç–æ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ –ø–æ–º–æ—â—å. –Ø –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –≤–∞–º –ø–æ–º–æ—á—å, –µ—Å–ª–∏ –≤—ã –Ω–µ —Å–º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ @pwp_programer

1.   ü§ñ  -  –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º?
    –î–ª—è –Ω–∞—á–∞–ª–∞ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ä–æ–¥ –∏–ª–∏ —Å—Ç—Ä–∞–Ω—É –≤ –∫–æ—Ç–æ—Ä–æ–π
    –≤—ã —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å –Ω–∞
    —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –∏ –≤–≤–µ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –≤–∞–º–∏ –º–µ—Å—Ç–æ.

    –î–∞–ª–µ–µ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–£–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É", –¥–ª—è —Ç–æ–≥–æ
    —á—Ç–æ –±—ã —É–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –≤–∞–º–∏ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏.

2.  ‚ùì  -  –ó–∞—á–µ–º –Ω—É–∂–µ–Ω —ç—Ç–æ—Ç –±–æ—Ç?
    –î–∞–Ω–Ω—ã–π –±–æ—Ç –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–∑—É—á–µ–Ω–∏—è python –∏
    telebot. –ê–≤—Ç–æ—Ä –Ω–µ –∏–º–µ–µ—Ç –∫–∞–∫–æ–π-–ª–∏–±–æ —Ü–µ–ª–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–π
    –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏ –∏ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—é –±–æ—Ç–∞. –î–∞–ª—å–Ω–µ–π—à–∞—è —Å—É–¥—å–±–∞ –±–æ—Ç–∞
    –Ω–µ –∏–∑–≤–µ—Å—Ç–Ω–∞.

3.  üìµ  -  –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º.
    –ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –∫–∞–∫–æ–π-–ª–∏–±–æ –ø—Ä–æ–±–ª–µ–º–æ–π, —Ç–æ –≤–∞–º
    –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
        1. –°–¥–µ–ª–∞—Ç—å —Å–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –µ–≥–æ –∑–∞–ø–∏—Å—å, –≥–¥–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞
        –≤–∞—à–∞ –ø—Ä–æ–±–ª–µ–º–∞.

        2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ @pwp_programer, –¥–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –∏ –ø–æ–¥—Ä–æ–±–Ω–æ
        —Ä–∞—Å–ø–∏—à–∏—Ç–µ –≤ —á—ë–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–∞ –∏ –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        –∫ –Ω–µ–π –ø—Ä–∏–≤–æ–¥—è—Ç.

        3. –ü—Ä–æ—è–≤–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ —Ç–µ—Ä–ø–µ–Ω–∏—è –∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–∫–∞ –≤–∞—à–∞
        –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞.

ü§ñ  -  Bot ver 1.0
            ''')

    if message.text == "‚òÄÔ∏è  -  –£–∑–Ω–∞—Ç—å –ø–æ–≥–æ–¥—É":
        # !FIXME –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –±–µ–∑ –≤–≤–æ–¥–∞ –ª–æ–∫–∞—Ü–∏–∏
        if tmp[message.chat.id]:
            # FIXME –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø–æ–≥–æ–¥—É –Ω–∞ –Ω–µ–¥–µ–ª—é
            config_dict = get_default_config()
            config_dict['language'] = 'ru'  # –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö

            # –ó–∞–Ω–æ—Å–∏–º –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é —Ç–µ–∫—Å—Ç –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è(–ø–æ–∫–∞ –æ–Ω –ø—É—Å—Ç–æ–π)
            place = tmp[message.chat.id][0]
            # –¢–æ–∫–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –ø–æ–≥–æ–¥—ã
            owm = OWM('32fadfddbc16c9c16e64a4cdf27d9502', config_dict)
            mgr = owm.weather_manager()

            # –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            try:
                observation = mgr.weather_at_place(place)

                w = observation.weather

                t = w.temperature("celsius")
                t1 = t['temp']
                t2 = t['feels_like']
                t3 = t['temp_max']
                t4 = t['temp_min']

                wi = w.wind()['speed']
                humi = w.humidity
                cl = w.clouds
                dt = w.detailed_status
                ti = w.reference_time('iso')
                pr = w.pressure['press']
                vd = w.visibility_distance

                bot.send_message(
                    message.chat.id,
                    "üåÉ  -  –í –≥–æ—Ä–æ–¥–µ: " + str(place) + "\nüå° -  –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: " + str(t1) + " ¬∞C" + "\n" +
                    "üìà  -  –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: " + str(t3) + " ¬∞C" + "\n" +
                    "üìâ  -  –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: " + str(t4) + " ¬∞C" + "\n" +
                    "üßç‚Äç‚ôÇÔ∏è  -  –û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫: " + str(t2) + " ¬∞C" + "\n" +
                    "üí®  -  –°–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞: " + str(wi) + " –º/—Å" + "\n" +
                    "üì°  -  –î–∞–≤–ª–µ–Ω–∏–µ: " + str(pr) + " –º–º.—Ä—Ç.—Å—Ç" + "\n" +
                    "üí¶  -  –í–ª–∞–∂–Ω–æ—Å—Ç—å: " + str(humi) + " %" + "\n" +
                    "üëÄ  -  –í–∏–¥–∏–º–æ—Å—Ç—å: " + str(vd) + "  –º–µ—Ç—Ä–æ–≤" + "\n" +
                    "üìñ  -  –û–ø–∏—Å–∞–Ω–∏–µ: " + str(dt))
            except:
                bot.send_message(
                    message.chat.id, "–¢–∞–∫–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞...")

        else:
            bot.send_message(message.chat.id, "–í—ã –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–ª–∏ –≥–æ—Ä–æ–¥")


def city(message: string) -> string:
    """[–°—á–∏—Ç—ã–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã]

    Args:
        message ([type]): [description]
    """
    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –º–µ—Å—Ç–∞
    tmp[message.chat.id] = []
    tmp[message.chat.id].append(message.text)
    print(tmp)
    bot.send_message(
        message.chat.id, f"–í—ã –≤—ã–±—Ä–∞–ª–∏ –≥–æ—Ä–æ–¥: {tmp[message.chat.id][0]}", reply_markup=buttons)


if __name__ == '__main__':
    bot.polling(none_stop=True)
